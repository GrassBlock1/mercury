---
import type { MarkdownHeading } from 'astro';
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../../i18n/utils.ts';
import TOCBase from './base.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);


interface Props {
    headings: MarkdownHeading[];
}

const { headings } = Astro.props;
---
<div class="contents-button">
    <input type="checkbox" id="contents-toggle" class="contents-toggle" />
    <label for="contents-toggle" class="contents-label" aria-expanded="false">
        <span class="label-text">{t('widget.contents')}</span>
    </label>
    <div class="contents-panel" role="dialog" aria-labelledby="contents-toggle">
        <TOCBase headings={headings}/>
    </div>
</div>

<style>
    div.contents-button {
        position: fixed;
        right: 45px;
        bottom: 12rem;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.5rem;
        pointer-events: none; /* allow children to control pointer events */
    }

    /* Keep checkbox accessible but visually hidden */
    .contents-toggle {
        opacity: 0;
        cursor: pointer;
        height: 1px;
        width: 1px;
        margin: -1px;
        position: relative;
        pointer-events: auto;
    }

    /* Floating button */
    .contents-label {
        pointer-events: auto;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: var(--border-color);
        color: var(--text-color);
        padding: 0.5rem 1rem;
        cursor: pointer;
        user-select: none;
    }
    .contents-label .label-text {
        font-size: .9rem;
    }
    /* Panel that contains the TOC, hidden by default */
    .contents-panel {
        display: none;
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        width: 320px;
        max-width: 80vw;
        max-height: 60vh;
        padding: 0.5rem;
        overflow: auto;
        pointer-events: auto;
        font-size: .9rem;
    }

    /* Show panel when checkbox is checked */
    .contents-toggle:checked ~ .contents-panel {
        display: block;
    }
</style>